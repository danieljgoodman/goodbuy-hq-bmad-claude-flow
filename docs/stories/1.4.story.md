# Story 1.4: Basic AI Business Health Assessment

## Status
Draft

## Story
**As a** business owner,
**I want** to receive an initial AI-powered business health score based on my submitted information,
**so that** I can get immediate value and understand the platform's AI capabilities.

## Acceptance Criteria
1. Basic AI scoring algorithm integrating Claude API to analyze revenue trends, industry benchmarks, and operational metrics
2. Health score display (1-100) with color-coded visualization, explanation of scoring factors, and improvement areas
3. Top 3 immediate areas for improvement with brief AI-generated descriptions and impact potential
4. Professional results page demonstrating platform value with clear methodology explanation to build trust
5. Clear call-to-action for accessing detailed AI analysis and premium implementation guidance

## Tasks / Subtasks
- [ ] Integrate Claude AI API for business analysis (AC: 1)
  - [ ] Set up Claude API service with authentication and rate limiting
  - [ ] Create AI prompt templates for business health analysis
  - [ ] Implement revenue trend analysis and industry benchmarking logic
  - [ ] Add operational metrics scoring and confidence calculations
- [ ] Build health score calculation and visualization (AC: 2)
  - [ ] Create health scoring algorithm with 1-100 scale
  - [ ] Implement color-coded health score display component
  - [ ] Add explanation of scoring factors and methodology
  - [ ] Create improvement areas identification and ranking
- [ ] Generate AI-powered improvement recommendations (AC: 3)
  - [ ] Implement top 3 improvement opportunities identification
  - [ ] Create AI-generated descriptions with impact potential estimates
  - [ ] Add opportunity categorization (operational, financial, strategic, market)
  - [ ] Implement confidence scoring for recommendations
- [ ] Design professional results presentation (AC: 4)
  - [ ] Create comprehensive results page layout with data visualization
  - [ ] Add clear methodology explanation and trust-building elements
  - [ ] Implement responsive design for various screen sizes
  - [ ] Add results export and sharing functionality
- [ ] Implement premium upgrade call-to-action (AC: 5)
  - [ ] Create compelling upgrade prompts for detailed analysis
  - [ ] Add premium feature preview and value proposition
  - [ ] Implement conversion tracking for upgrade flow
  - [ ] Create clear pathway to premium implementation guidance

## Dev Notes

### Previous Story Insights
Story 1.3 provides complete business data collection needed for AI analysis input.

### Data Models
**BusinessEvaluation Model Updates** [Source: architecture/data-models.md#businessevaluation]:
```typescript
interface BusinessEvaluation {
  id: string;
  userId: string;
  businessData: {
    annualRevenue: number;
    monthlyRecurring: number;
    expenses: number;
    cashFlow: number;
    assets: number;
    liabilities: number;
    customerCount: number;
    marketPosition: string;
  };
  valuations: {
    assetBased: number;
    incomeBased: number;
    marketBased: number;
    weighted: number;
    methodology: string;
  };
  healthScore: number;           // Primary output of this story
  confidenceScore: number;       // AI confidence in analysis
  topOpportunities: ImprovementOpportunity[]; // Top 3 recommendations
  status: 'processing' | 'completed' | 'failed';
  createdAt: Date;
  updatedAt: Date;
}
```

**ImprovementOpportunity Model** [Source: architecture/data-models.md#improvementopportunity]:
```typescript
interface ImprovementOpportunity {
  id: string;
  category: 'operational' | 'financial' | 'strategic' | 'market';
  title: string;
  description: string;
  impactEstimate: {
    dollarAmount: number;
    percentageIncrease: number;
    confidence: number;
  };
  difficulty: 'low' | 'medium' | 'high';
  timeframe: string;
  priority: number;
  implementationGuide?: string; // Premium content
  requiredResources: string[];
}
```

### API Specifications
**Claude AI Integration** [Source: architecture/external-apis.md#claude-ai-api]:
- **Base URL:** https://api.anthropic.com/v1
- **Authentication:** API Key with Bearer token authentication
- **Rate Limits:** 4,000 requests per minute for Claude 3.5 Sonnet
- **Key Endpoint:** `POST /messages` - AI analysis for business valuations and health scoring
- **Integration Notes:** Persistent HTTP connections for <3 second response requirements, response caching with Redis

**Business Evaluation API Routes** [Source: architecture/backend-architecture.md#service-architecture]:
- `/api/business-evaluations` - POST for creating new evaluations
- `/api/business-evaluations/[id]/analyze` - POST for triggering AI analysis
- Repository pattern implementation with BaseRepository class

### Component Specifications
**Evaluation Display Components** [Source: architecture/frontend-architecture.md#component-organization]:
```
src/components/evaluation/
├── valuation-results.tsx    # Complete results display page
├── health-score.tsx         # Health score visualization component
└── opportunities-list.tsx   # Top 3 improvement opportunities display
```

**Data Visualization Components** [Source: architecture/frontend-architecture.md#component-organization]:
```
src/components/charts/
├── valuation-chart.tsx      # Business valuation visualization
├── health-trend-chart.tsx   # Health score trends and factors
└── progress-chart.tsx       # Improvement opportunity impact charts
```

### File Locations
**AI Integration Structure** [Source: architecture/unified-project-structure.md]:
```
apps/web/src/
├── app/
│   ├── evaluation/         # Evaluation results pages
│   │   └── [id]/page.tsx
├── components/
│   ├── evaluation/         # Results display components
│   ├── charts/            # Data visualization components
│   └── premium/           # Upgrade prompts and premium previews
├── lib/
│   ├── services/          # AI integration services
│   │   ├── claude-service.ts
│   │   └── evaluation-service.ts
│   ├── repositories/      # Data access layer
│   │   └── evaluation-repository.ts
│   └── utils/            # AI processing utilities
└── types/                # AI response type definitions
    └── claude-types.ts
```

### Technical Constraints
**AI Processing Standards** [Source: architecture/coding-standards.md#critical-fullstack-rules]:
- AI Processing: Always include confidence scores and methodology explanations
- Error Handling: All API routes must use the standard error handler
- Premium Features: Gate premium content through subscription checks, not UI hiding
- Input Validation: Use Zod schemas for all API input validation

**Claude AI Integration Requirements** [Source: architecture/external-apis.md#claude-ai-api]:
- Response caching with Redis for performance optimization
- Error handling for rate limits and API failures  
- Persistent HTTP connections for <3 second response requirements

### External APIs
**Claude AI Service Integration** [Source: architecture/external-apis.md#claude-ai-api]:
- Primary AI engine for business valuation analysis and health scoring
- Health score calculations and industry benchmarking analysis
- Implementation guide generation for premium subscribers
- Rate limit management and response caching required

### Testing Requirements
**AI Integration Testing Strategy** [Source: architecture/testing-strategy.md#testing-pyramid]:
- Unit Tests: Vitest for AI service functions and scoring algorithms
- Integration Tests: Mock Claude API responses for consistent testing
- E2E Tests: Playwright for complete evaluation and results workflow

## Testing
**Test Organization** [Source: architecture/testing-strategy.md#test-organization]:
- Test files located in `tests/` directory within apps/web/
- Testing frameworks: Vitest for unit/integration, Playwright for E2E
- Target: 90%+ coverage for critical AI processing logic

**Testing Standards for this Story**:
- Test Claude API integration with mock responses
- Test health score calculation accuracy and consistency
- Test improvement opportunity generation and ranking
- Test error handling for AI service failures and rate limits
- Test results display and visualization components

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-09-05 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be filled by dev agent*

### Debug Log References
*To be filled by dev agent*

### Completion Notes List
*To be filled by dev agent*

### File List
*To be filled by dev agent*

## QA Results
*Results from QA Agent QA review will be added here after story completion*